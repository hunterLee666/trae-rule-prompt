---
name: TRAE Quality Layer
description: 质量保障层 - LSP诊断、代码审查、测试验证、质量指标
version: "7.0"
priority: 90
alwaysApply: true
---

# 04-quality/ 质量保障层

## 职责范围

质量保障层是TRAE系统的"质检员"，负责：
- **LSP诊断** - 实时代码错误和警告检测
- **代码审查** - 静态分析、最佳实践检查
- **测试验证** - 自动化测试执行和结果分析
- **质量门禁** - 预定义的质量标准和检查点
- **质量指标** - 可量化的质量度量和追踪

---

## 核心组件

### 1. LSP诊断 (lsp-diagnostics.md)
基于语言服务器协议的代码质量检查：

```yaml
诊断类型:
  Error:       # 必须修复
    - 语法错误
    - 类型错误
    - 未定义变量
    
  Warning:     # 建议修复
    - 未使用变量
    - 过时的API
    - 潜在的空指针
    
  Information: # 仅供参考
    - 风格建议
    - 优化提示
    
  Hint:        # 可选改进
    - 简化建议
    - 性能提示
```

**工作流程**：
1. 文件修改后自动触发
2. 收集所有诊断信息
3. 按严重程度分类
4. 生成修复建议
5. 跟踪修复进度

### 2. 验证规则 (validation-rules.md)
代码验证的标准规则集：

```yaml
规则类别:
  Syntax:
    - 语言特定语法检查
    - 代码格式验证
    
  Semantic:
    - 类型一致性
    - 变量作用域
    - 导入/导出检查
    
  Style:
    - 命名约定
    - 代码格式
    - 注释规范
    
  Security:
    - 敏感数据检测
    - 注入风险检查
    - 依赖安全扫描
    
  Performance:
    - 复杂度分析
    - 资源使用检查
    - 优化建议
```

### 3. 测试模式 (testing-patterns.md)
自动化测试策略：

```yaml
测试层级:
  Unit Tests:
    - 函数/方法级别
    - 快速执行
    - 高覆盖率要求
    
  Integration Tests:
    - 组件交互测试
    - 边界条件测试
    - 数据流验证
    
  E2E Tests:
    - 用户场景测试
    - 关键路径验证
    - 端到端流程

测试驱动开发 (TDD):
  1. RED: 编写失败的测试
  2. GREEN: 编写最小代码使测试通过
  3. REFACTOR: 重构代码，测试保持通过
```

### 4. 代码审查 (code-review.md)
代码审查的标准流程：

```yaml
审查维度:
  Correctness:
    - 功能正确性
    - 边界条件处理
    - 错误处理
    
  Maintainability:
    - 代码清晰度
    - 可测试性
    - 文档完整性
    
  Performance:
    - 算法效率
    - 资源使用
    - 可扩展性
    
  Security:
    - 数据验证
    - 权限检查
    - 敏感信息保护

审查清单:
  □ 代码是否符合设计文档
  □ 是否添加了适当的测试
  □ 是否更新了相关文档
  □ 是否处理了所有边界情况
  □ 是否进行了安全审查
```

### 5. 质量门禁 (quality-gates.md)
预定义的质量检查点：

```yaml
门禁级别:
  Level 1 - 基础:
    - 语法检查通过
    - 无Error级别诊断
    - 单元测试通过
    
  Level 2 - 标准:
    - Level 1通过
    - 无Warning级别诊断
    - 代码覆盖率>80%
    - 代码审查通过
    
  Level 3 - 严格:
    - Level 2通过
    - 集成测试通过
    - 性能基准测试通过
    - 安全扫描通过
    
  Level 4 - 生产:
    - Level 3通过
    - E2E测试通过
    - 压力测试通过
    - 合规检查通过
```

### 6. 质量指标 (metrics.md)
可量化的质量度量：

```yaml
代码质量指标:
  - 代码覆盖率
  - 圈复杂度
  - 重复代码率
  - 技术债务指数
  
流程质量指标:
  - 构建成功率
  - 测试通过率
  - 审查通过率
  - 缺陷密度
  
业务价值指标:
  - 功能完成度
  - 性能提升
  - 用户满意度
  - 交付速度
```

---

## 快速参考

```yaml
质量检查流程:
  1. lsp_diagnostics → 静态检查
  2. 代码审查 → 人工/自动审查
  3. 测试执行 → 单元/集成/E2E
  4. 质量门禁 → 级别验证
  5. 指标收集 → 数据追踪

修复优先级:
  Error > Warning > Information > Hint
  安全 > 功能 > 性能 > 风格
```

---

## 文件清单

| 文件 | 说明 | 来源 |
|------|------|------|
| README.md | 本文件 | 新建 |
| lsp-diagnostics.md | LSP诊断 | opencode-study/02-lsp-integration.md提取 |
| validation-rules.md | 验证规则 | 原02-execution/core-guide.md提取 |
| testing-patterns.md | 测试模式 | 新建 |
| code-review.md | 代码审查 | 新建 |
| quality-gates.md | 质量门禁 | 新建 |
| metrics.md | 质量指标 | 新建 |

---

## 相关层

- ↑ 调用: 02-engine/ (执行引擎)
- → 协作: 05-security/ (安全隐私)
- → 输出: 报告给 SYSTEM.md

---

## 质量检查点

在以下时机触发质量检查：
1. **编辑后** - 文件保存时自动触发LSP诊断
2. **提交前** - 运行测试和代码审查
3. **构建时** - 执行质量门禁
4. **发布前** - 全面质量验证

---

> **核心原则**: "质量不是检查出来的，而是设计出来的。"
