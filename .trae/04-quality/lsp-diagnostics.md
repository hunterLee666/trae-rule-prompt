---
name: LSP Diagnostics
description: LSP诊断 - 实时代码质量检查
version: "7.0"
priority: 90
alwaysApply: true
---

# LSP诊断

> **"实时检查，即时反馈。"**

## 一、诊断类型

```yaml
Error (必须修复):
  类型: 阻塞性错误
  示例:
    - 语法错误
    - 类型错误
    - 未定义变量
    - 导入错误
  处理: 立即修复，否则无法运行

Warning (建议修复):
  类型: 潜在问题
  示例:
    - 未使用变量
    - 过时的API
    - 潜在的空指针
    - 类型不匹配
  处理: 建议修复，提高代码质量

Information (仅供参考):
  类型: 信息提示
  示例:
    - 风格建议
    - 优化提示
    - 文档缺失
  处理: 可选改进

Hint (可选改进):
  类型: 改进建议
  示例:
    - 简化建议
    - 性能提示
    - 代码组织
  处理: 可选改进
```

## 二、诊断流程

```yaml
标准流程:
  1. 触发诊断
     - 文件保存时自动触发
     - 手动调用 lsp_diagnostics
     
  2. 收集结果
     - 获取所有诊断信息
     - 按严重程度分类
     
  3. 分析问题
     - 理解问题原因
     - 评估影响范围
     
  4. 制定修复方案
     - 确定修复优先级
     - 选择修复策略
     
  5. 执行修复
     - 应用修复方案
     - 验证修复结果
     
  6. 再次诊断
     - 确认问题已解决
     - 检查是否引入新问题
```

## 三、修复优先级

```yaml
优先级规则:
  1. Error > Warning > Information > Hint
  2. 安全 > 功能 > 性能 > 风格
  3. 核心代码 > 测试代码 > 配置代码

修复顺序:
  Step 1: 修复所有Error
  Step 2: 修复高优先级Warning
  Step 3: 修复其他Warning
  Step 4: 处理Information和Hint
```

## 四、常见诊断问题

### 4.1 语法错误

```yaml
常见原因:
  - 括号不匹配
  - 缺少分号
  - 缩进错误
  - 关键字拼写错误

修复方法:
  - 检查语法结构
  - 使用代码格式化工具
  - 参考语言规范
```

### 4.2 类型错误

```yaml
常见原因:
  - 类型不匹配
  - 缺少类型定义
  - 泛型使用错误

修复方法:
  - 添加类型注解
  - 使用类型转换
  - 修正类型定义
```

### 4.3 未定义变量

```yaml
常见原因:
  - 变量名拼写错误
  - 忘记导入
  - 作用域问题

修复方法:
  - 检查变量名拼写
  - 添加导入语句
  - 调整作用域
```

## 五、诊断报告

```markdown
## 📊 诊断报告

### 问题统计
| 级别 | 数量 | 状态 |
|-----|------|------|
| Error | X | 待修复 |
| Warning | X | 待修复 |
| Information | X | 可选 |
| Hint | X | 可选 |

### 问题详情

#### Error (必须修复)
1. **[文件:行号]** 问题描述
   - 原因: ...
   - 建议: ...

#### Warning (建议修复)
1. **[文件:行号]** 问题描述
   - 原因: ...
   - 建议: ...
```

## 六、最佳实践

```yaml
诊断习惯:
  - 修改后立即检查
  - 不忽略Warning
  - 定期全面检查

修复策略:
  - 一次修复一个问题
  - 修复后验证
  - 保持代码整洁

预防措施:
  - 使用类型检查
  - 遵循编码规范
  - 编写单元测试
```
