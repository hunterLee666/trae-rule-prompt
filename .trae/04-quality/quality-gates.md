---
name: Quality Gates
description: 质量门禁 - 预定义的质量检查点
version: "7.0"
priority: 90
alwaysApply: true
---

# 质量门禁

> **"质量关卡，层层把关。"**

## 一、门禁级别

```yaml
Level 1 - 基础:
  检查项:
    - 语法检查通过
    - 无Error级别诊断
    - 单元测试通过
  适用: 快速迭代、原型开发

Level 2 - 标准:
  检查项:
    - Level 1全部通过
    - 无Warning级别诊断
    - 代码覆盖率 > 80%
    - 代码审查通过
  适用: 常规开发、功能迭代

Level 3 - 严格:
  检查项:
    - Level 2全部通过
    - 集成测试通过
    - 性能基准测试通过
    - 安全扫描通过
  适用: 核心模块、关键功能

Level 4 - 生产:
  检查项:
    - Level 3全部通过
    - E2E测试通过
    - 压力测试通过
    - 合规检查通过
  适用: 生产发布、重大更新
```

## 二、门禁阈值标准

### 2.1 代码质量阈值

| 指标 | Level 1 | Level 2 | Level 3 | Level 4 |
|-----|---------|---------|---------|---------|
| 代码覆盖率 | ≥60% | ≥80% | ≥90% | ≥95% |
| 分支覆盖率 | ≥50% | ≥70% | ≥85% | ≥90% |
| 圈复杂度 | ≤20 | ≤15 | ≤10 | ≤8 |
| 认知复杂度 | ≤25 | ≤20 | ≤15 | ≤12 |
| 代码重复率 | ≤10% | ≤5% | ≤3% | ≤1% |
| 技术债务比例 | ≤20% | ≤10% | ≤5% | ≤2% |

### 2.2 性能阈值

| 指标 | Level 1 | Level 2 | Level 3 | Level 4 |
|-----|---------|---------|---------|---------|
| API响应时间 | ≤1000ms | ≤500ms | ≤200ms | ≤100ms |
| 内存使用 | ≤512MB | ≤256MB | ≤128MB | ≤64MB |
| CPU使用率 | ≤80% | ≤60% | ≤40% | ≤30% |
| 启动时间 | ≤30s | ≤15s | ≤10s | ≤5s |

### 2.3 安全阈值

| 指标 | Level 1 | Level 2 | Level 3 | Level 4 |
|-----|---------|---------|---------|---------|
| 高危漏洞 | 0 | 0 | 0 | 0 |
| 中危漏洞 | ≤5 | ≤2 | 0 | 0 |
| 低危漏洞 | ≤10 | ≤5 | ≤2 | 0 |
| 敏感数据暴露 | 0 | 0 | 0 | 0 |

### 2.4 文档阈值

| 指标 | Level 1 | Level 2 | Level 3 | Level 4 |
|-----|---------|---------|---------|---------|
| 公共API文档覆盖 | ≥50% | ≥80% | ≥95% | 100% |
| README完整性 | ≥60% | ≥80% | ≥95% | 100% |
| 注释覆盖率 | ≥20% | ≥40% | ≥60% | ≥80% |

## 三、门禁流程

```yaml
执行流程:
  1. 触发门禁
     - 代码提交时
     - 合并请求时
     - 发布前
     
  2. 执行检查
     - 按级别执行检查项
     - 收集检查结果
     - 计算各项指标
     
  3. 评估结果
     - 对比阈值标准
     - 全部通过 → 通过门禁
     - 有失败项 → 阻止操作
     
  4. 报告结果
     - 生成门禁报告
     - 列出未达标项
     - 提供修复建议
```

## 三、检查项详解

### 3.1 语法检查

```yaml
检查内容:
  - 语法正确性
  - 格式规范性
  - 编码风格

工具:
  - LSP诊断
  - Linter工具
  - 格式化工具
```

### 3.2 测试检查

```yaml
单元测试:
  - 测试通过率: 100%
  - 覆盖率要求: > 80%
  - 边界条件覆盖

集成测试:
  - 接口测试
  - 数据流测试
  - 异常处理测试

E2E测试:
  - 关键路径测试
  - 用户场景测试
  - 兼容性测试
```

### 3.3 安全检查

```yaml
检查内容:
  - 敏感数据检测
  - 注入风险检查
  - 权限验证
  - 依赖安全扫描

工具:
  - 静态分析工具
  - 依赖扫描工具
  - 安全审计工具
```

### 3.4 性能检查

```yaml
检查内容:
  - 响应时间
  - 资源使用
  - 并发性能

基准测试:
  - 性能基准
  - 回归检测
  - 瓶颈分析
```

## 四、门禁报告

```markdown
## 🚪 质量门禁报告

### 门禁级别: Level X

### 检查结果
| 检查项 | 状态 | 详情 |
|-------|------|------|
| 语法检查 | ✅/❌ | ... |
| 单元测试 | ✅/❌ | 覆盖率: X% |
| 代码审查 | ✅/❌ | ... |
| 安全扫描 | ✅/❌ | ... |

### 总体结果: ✅通过 / ❌未通过

### 修复建议
[如有未通过项，提供修复建议]
```

## 五、最佳实践

```yaml
门禁配置:
  - 根据项目特点选择级别
  - 核心模块使用高级别
  - 原型开发可降低级别

持续改进:
  - 定期评估门禁效果
  - 调整检查项和阈值
  - 优化检查效率

团队协作:
  - 明确门禁规则
  - 提供修复指导
  - 及时处理阻塞
```
