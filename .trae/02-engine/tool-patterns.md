---
name: Tool Patterns
description: 工具调用模式 - 最佳实践与优化策略
version: "7.0"
priority: 90
alwaysApply: true
---

# 工具调用模式

> **"正确工具，正确方式。"**

## 一、工具选择策略

```yaml
选择原则:
  1. 精确匹配: 选择最适合的工具
  2. 最小化: 使用最少的工具调用
  3. 可靠性: 优先使用稳定工具
  4. 效率: 考虑执行时间和资源

工具分类:
  探索类:
    - glob: 文件查找
    - grep: 内容搜索
    - lsp_symbols: 符号提取
    
  理解类:
    - read: 读取内容
    - lsp_goto_definition: 跳转定义
    - lsp_find_references: 查找引用
    
  修改类:
    - write: 写入文件
    - edit: 编辑文件
    - delete: 删除文件
    
  验证类:
    - lsp_diagnostics: 诊断检查
    - bash: 运行测试
```

## 二、并行vs串行

### 2.1 并行执行

```yaml
适用场景:
  - 操作之间无依赖
  - 读取多个独立文件
  - 搜索多个模式

并行示例:
  同时执行:
    - glob("*.py")
    - glob("*.js")
    - grep("TODO")
    
  优势:
    - 减少总执行时间
    - 提高效率
```

### 2.2 串行执行

```yaml
适用场景:
  - 操作之间有依赖
  - 后续操作依赖前序结果
  - 修改后需要验证

串行示例:
  顺序执行:
    1. read(file) → 获取内容
    2. edit(file) → 修改内容
    3. lsp_diagnostics(file) → 验证修改
```

## 三、错误处理

### 3.1 错误类型

```yaml
错误分类:
  文件错误:
    - 文件不存在
    - 权限不足
    - 路径无效
    
  执行错误:
    - 命令执行失败
    - 超时
    - 资源不足
    
  验证错误:
    - 诊断检查失败
    - 测试失败
    - 类型错误
```

### 3.2 错误恢复

```yaml
恢复策略:
  重试:
    - 网络请求失败
    - 临时资源不足
    
  降级:
    - 主方案失败时使用备选方案
    
  回滚:
    - 修改失败时恢复原状态
    
  报告:
    - 无法恢复时报告错误
```

## 四、性能优化

### 4.1 缓存策略

```yaml
缓存场景:
  - 已读取的文件内容
  - LSP分析结果
  - 搜索结果

缓存规则:
  - 文件未修改时复用缓存
  - 修改后清除相关缓存
  - 定期清理过期缓存
```

### 4.2 批量操作

```yaml
批量读取:
  - 一次读取多个文件
  - 减少IO次数
  
批量搜索:
  - 合并相似搜索
  - 使用更广泛的模式
```

## 五、最佳实践

### 5.1 文件操作

```yaml
读取最佳实践:
  - 先glob定位，再read读取
  - 大文件分批读取
  - 优先读取关键部分

修改最佳实践:
  - 修改前备份
  - 使用精确的old_str
  - 修改后立即验证
```

### 5.2 代码分析

```yaml
LSP最佳实践:
  - 先symbols了解结构
  - 再goto深入理解
  - 最后find_references评估影响

诊断最佳实践:
  - 修改后立即检查
  - 优先处理Error级别
  - 逐步解决Warning
```

### 5.3 命令执行

```yaml
命令最佳实践:
  - 使用明确的命令
  - 处理命令输出
  - 设置合理的超时
  - 验证执行结果
```

## 六、工具组合模式

### 6.1 探索模式

```yaml
探索代码库:
  1. glob("*.py") → 找到相关文件
  2. lsp_symbols(file) → 了解文件结构
  3. read(file) → 深入理解内容
  4. lsp_goto_definition → 理解依赖
```

### 6.2 重构模式

```yaml
安全重构:
  1. lsp_find_references → 评估影响
  2. read(file) → 理解当前实现
  3. edit(file) → 执行修改
  4. lsp_diagnostics → 验证修改
  5. bash("npm test") → 运行测试
```

### 6.3 调试模式

```yaml
问题调试:
  1. grep("error") → 搜索错误信息
  2. read(file) → 查看相关代码
  3. lsp_goto_definition → 追踪调用链
  4. 分析根因
  5. edit(file) → 修复问题
  6. bash("npm test") → 验证修复
```
