---
name: Task Decomposition Check
description: 任务分解检查触发器 - 复杂任务开始时强制执行
version: "1.0"
priority: 90
alwaysApply: true
trigger: "before_complex_task"
---

# 任务分解检查触发器

> **⚠️ 强制规则：复杂任务开始前必须进行任务分解**

---

## 一、触发条件

```yaml
触发场景:
  - 任务预估步骤 > 5步
  - 涉及多个文件修改
  - 需要多个工具配合
  - 任务有复杂依赖关系
  - 用户描述模糊的任务
  - 功能开发类任务

不触发场景:
  - 简单查询任务
  - 单文件操作
  - 明确的单一步骤任务
```

---

## 二、复杂度评估

### 2.1 复杂度等级

```yaml
L1 - 简单任务:
  特征: 单一操作，明确目标
  步骤: 1-2步
  工具: 1个
  示例: 读取文件、搜索内容、简单查询
  处理: 直接执行

L2 - 中等任务:
  特征: 多步骤，有依赖关系
  步骤: 3-5步
  工具: 2-3个
  示例: 代码重构、依赖分析、文档生成
  处理: 简单分解后执行

L3 - 复杂任务:
  特征: 多模块协作，需要规划
  步骤: 5-10步
  工具: 3-5个
  示例: 功能开发、架构重构、性能优化
  处理: 必须分解，展示计划

L4 - 超复杂任务:
  特征: 开放式，需要迭代调整
  步骤: 10+步
  工具: 5+个
  示例: 系统设计、问题诊断、创新方案
  处理: 分阶段分解，迭代执行
```

### 2.2 评估算法

```yaml
评分维度:
  操作数量:
    1-2个操作: +1分
    3-5个操作: +2分
    6-10个操作: +3分
    10+个操作: +4分
  
  依赖关系:
    无依赖: +1分
    简单依赖: +2分
    复杂依赖: +3分
  
  不确定性:
    明确目标: +1分
    需要澄清: +2分
    开放式: +3分
  
  影响范围:
    单文件: +1分
    多文件: +2分
    多模块: +3分
    系统级: +4分

等级判定:
  1-4分: L1 简单
  5-7分: L2 中等
  8-10分: L3 复杂
  11+分: L4 超复杂
```

---

## 三、分解策略

### 3.1 分解原则

```yaml
MECE原则:
  - 相互独立: 子任务之间不重叠
  - 完全穷尽: 所有子任务覆盖完整任务

粒度控制:
  - 单个子任务可在合理时间内完成
  - 子任务有明确的输入输出
  - 子任务可独立验证

依赖管理:
  - 识别任务间依赖关系
  - 按依赖顺序排列
  - 标注并行可执行任务
```

### 3.2 分解模板

```yaml
任务分解表:
  任务名称: [原任务名称]
  复杂度等级: L1/L2/L3/L4
  预估步骤: X步
  
  子任务列表:
    - 序号: 1
      名称: [子任务名称]
      描述: [具体描述]
      工具: [需要的工具]
      依赖: [依赖的子任务序号]
      输出: [预期输出]
      状态: 待执行/进行中/已完成
    
    - 序号: 2
      ...
```

---

## 四、执行计划输出

```markdown
## 📋 任务分解计划

### 任务概述
- **任务名称**: 实现用户登录功能
- **复杂度等级**: L3 (复杂)
- **预估步骤**: 7步
- **涉及文件**: 5个

### 复杂度评估
| 维度 | 得分 | 说明 |
|-----|------|------|
| 操作数量 | 3 | 涉及多个操作 |
| 依赖关系 | 2 | 有简单依赖 |
| 不确定性 | 2 | 需要澄清细节 |
| 影响范围 | 3 | 多模块影响 |
| **总分** | **10** | L3 复杂任务 |

### 子任务分解

| 序号 | 子任务 | 工具 | 依赖 | 输出 |
|-----|--------|------|------|------|
| 1 | 分析现有认证代码 | Read, Grep | - | 现有代码结构 |
| 2 | 设计登录流程 | - | 1 | 流程图/设计文档 |
| 3 | 实现后端API | Write | 2 | API代码 |
| 4 | 实现前端页面 | Write | 2 | 前端代码 |
| 5 | 编写单元测试 | Write | 3,4 | 测试代码 |
| 6 | 集成测试 | RunCommand | 5 | 测试报告 |
| 7 | 更新文档 | Write | 6 | 使用文档 |

### 执行顺序
```
1 → 2 → 3 ─┬→ 5 → 6 → 7
           └→ 4 ─┘
```

### 风险提示
- 需要确认认证方式（JWT/Session）
- 需要确认密码加密算法
```

---

## 五、快速检查卡

```
┌─────────────────────────────────────────────┐
│           任务分解速查表                     │
├─────────────────────────────────────────────┤
│                                             │
│  复杂度评估:                                 │
│    □ 操作数量 (1-4分)                       │
│    □ 依赖关系 (1-3分)                       │
│    □ 不确定性 (1-3分)                       │
│    □ 影响范围 (1-4分)                       │
│                                             │
│  等级判定:                                   │
│    1-4分 → L1 简单 → 直接执行               │
│    5-7分 → L2 中等 → 简单分解               │
│    8-10分 → L3 复杂 → 必须分解              │
│    11+分 → L4 超复杂 → 分阶段分解           │
│                                             │
│  分解原则:                                   │
│    □ MECE原则 (独立且穷尽)                  │
│    □ 粒度适中                               │
│    □ 依赖明确                               │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 六、违规示例

```yaml
❌ 错误示例:
  用户: "实现一个用户管理系统"
  行为: 直接开始写代码

✅ 正确示例:
  用户: "实现一个用户管理系统"
  行为:
    1. 评估复杂度: L4 超复杂
    2. 分解子任务:
       - 需求分析
       - 数据库设计
       - 后端API实现
       - 前端页面实现
       - 测试编写
       - 文档编写
    3. 展示分解计划
    4. 按计划执行
```

---

**记住**：复杂任务不分解，执行必出问题！
