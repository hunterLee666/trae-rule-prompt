---
name: Large Scale Project Rules
description: 大型项目规则 - 规模检测、性能优化、架构分层
version: "8.1"
priority: 85
alwaysApply: true
---

# 大型项目规则

> **"大项目需要大智慧。"**

## 一、项目规模检测

### 1.1 规模指标

```yaml
代码规模:
  小型项目:
    文件数: < 100
    代码行数: < 10,000
    依赖数: < 20
    
  中型项目:
    文件数: 100 - 500
    代码行数: 10,000 - 100,000
    依赖数: 20 - 100
    
  大型项目:
    文件数: 500 - 2000
    代码行数: 100,000 - 1,000,000
    依赖数: 100 - 500
    
  超大型项目:
    文件数: > 2000
    代码行数: > 1,000,000
    依赖数: > 500
```

### 1.2 复杂度指标

```yaml
结构复杂度:
  模块数: 项目独立模块数量
  依赖深度: 依赖图的最大深度
  循环依赖: 循环依赖的数量
  
团队复杂度:
  贡献者数: 活跃贡献者数量
  团队数: 参与团队数量
  代码审查周期: 平均审查时间
```

---

## 二、大型项目策略

### 2.1 代码组织

```yaml
目录结构:
  monorepo:
    packages/
      core/
      api/
      web/
      shared/
    tools/
    docs/
    
  multirepo:
    每个服务独立仓库
    共享库单独仓库
    配置中心仓库

模块划分:
  按功能划分:
    - 用户模块
    - 订单模块
    - 支付模块
    
  按层次划分:
    - 表现层
    - 业务层
    - 数据层
```

### 2.2 性能优化

```yaml
构建优化:
  增量构建:
    - 只构建变更部分
    - 缓存构建结果
    - 并行构建
    
  依赖优化:
    - 依赖预构建
    - 按需加载
    - Tree Shaking

运行时优化:
  缓存策略:
    - 多级缓存
    - 缓存预热
    - 缓存失效策略
    
  数据库优化:
    - 读写分离
    - 分库分表
    - 索引优化
```

### 2.3 代码审查

```yaml
审查策略:
  分层审查:
    - 架构审查 (架构师)
    - 模块审查 (模块负责人)
    - 代码审查 (团队成员)
    
  自动化审查:
    - 代码风格检查
    - 安全漏洞扫描
    - 性能分析

审查工具:
  - Gerrit (企业级)
  - GitHub/GitLab (团队协作)
  - Phabricator (Facebook开源)
```

---

## 三、架构分层

### 3.1 分层架构

```yaml
表现层 (Presentation):
  职责: 用户界面、API接口
  技术: React/Vue, REST/GraphQL
  规则: 不包含业务逻辑

应用层 (Application):
  职责: 用例编排、事务管理
  技术: Service层
  规则: 协调领域对象

领域层 (Domain):
  职责: 业务逻辑、领域模型
  技术: Entity, Value Object
  规则: 核心业务规则

基础设施层 (Infrastructure):
  职责: 数据持久化、外部服务
  技术: Repository, Gateway
  规则: 技术实现细节
```

### 3.2 模块边界

```yaml
边界定义:
  API边界:
    - 公开接口定义
    - 版本管理
    - 兼容性保证
    
  数据边界:
    - 数据所有权
    - 数据访问权限
    - 数据一致性
    
  部署边界:
    - 独立部署单元
    - 资源隔离
    - 故障隔离
```

---

## 四、监控与运维

### 4.1 监控体系

```yaml
应用监控:
  - APM (Application Performance Monitoring)
  - 分布式追踪
  - 日志聚合

基础设施监控:
  - 服务器监控
  - 网络监控
  - 存储监控

业务监控:
  - 关键业务指标
  - 用户行为分析
  - 异常检测
```

### 4.2 告警策略

```yaml
告警级别:
  P0 - 严重:
    条件: 服务不可用、数据丢失
    响应: 立即响应，5分钟内
    
  P1 - 高:
    条件: 性能严重下降、错误率飙升
    响应: 30分钟内响应
    
  P2 - 中:
    条件: 非关键功能异常
    响应: 4小时内响应
    
  P3 - 低:
    条件: 潜在风险、优化建议
    响应: 24小时内响应
```
